---
properties:
  activityArguments:
  action:
methods:
  getActionActivity:
  paintActivity:
events:
  pointerUp:
scripts:
- |
  this.initialize = function() {
    this.activityArguments = {
      floorKBID : "activity.ux floorKBID",
      wallKBID : "activity.ux wallKBID",
      doorWoodKBID : "activity.ux doorWoodKBID",
      doorSteelKBID : "activity.ux doorSteelKBID",
      distanceLeft : -1.0,
      distanceRight : -1.0,
      onEdge : false,
      paint : "activity.ux paint"
    };
    this.action = this.action || "activity.ux action";
  };

  this.getActionActivity = function(action) {
    var action,
        activityArguments = "undefined arguments";

    switch(action) {
    case "PLACE":
      activityArguments = [ this.activityArguments.wallKBID, this.activityArguments.floorKBID, this.activityArguments.onEdge];
      break;
    case "INSTALL":
      var doorKBID = (this.name == "doorWood_dae")? this.activityArguments.doorWoodKBID : this.activityArguments.doorSteelKBID;

      activityArguments = [ doorKBID, this.activityArguments.wallKBID, this.activityArguments.distanceLeft, this.activityArguments.distanceRight ];
      break;
    case "PAINT":
      var doorKBID = (this.name == "doorWood_dae")? this.activityArguments.doorWoodKBID : this.activityArguments.doorSteelKBID;

      activityArguments = [ doorKBID, this.activityArguments.paint ];
      break;
    }

    action = {  action: action, arguments: activityArguments };
    return action;
  };

  this.pointerUp = function(pointerInfo, pickInfo) {
    console.log("activity.ux pointerUp");

    var Vec3 = goog.vec.Vec3;

    this.activityArguments.onEdge = this._onEdge;

    if (this.action == "INSTALL") {
      var edgeDoorOneVec = Vec3.createFloat32FromArray(this.translation);
      var edgeDoorTwoVec = Vec3.createFloat32FromArray(this.translation);
      var edgeFloorOneVec = Vec3.createFloat32FromArray(this.parent.children['slab_dae'].translation);
      var edgeFloorTwoVec = Vec3.createFloat32FromArray(this.parent.children['slab_dae'].translation);

      Vec3.subtract(edgeDoorOneVec, Vec3.createFloat32FromArray([ 1.5, edgeDoorOneVec[1], edgeDoorOneVec[2] ]), edgeDoorOneVec);
      Vec3.add(edgeDoorTwoVec, Vec3.createFloat32FromArray([ 1.5, -edgeDoorTwoVec[1], -edgeDoorTwoVec[2] ]), edgeDoorTwoVec);
      // I'm going to cheat here and use 0 for the y and z components since I know the slab_dae is at 0, 0, 0 initially
      Vec3.subtract(edgeFloorOneVec, Vec3.createFloat32FromArray([ 10, 0, 0 ]), edgeFloorOneVec);
      Vec3.add(edgeFloorTwoVec, Vec3.createFloat32FromArray([ 10, 0, 0 ]), edgeFloorTwoVec);
      this.activityArguments.distanceLeft = Vec3.distance(edgeDoorOneVec, edgeFloorOneVec);
      this.activityArguments.distanceRight = Vec3.distance(edgeDoorTwoVec, edgeFloorTwoVec);
    }

    $('#debugMsg').text(JSON.stringify(this.getActionActivity(this.action)));
  	$.ajax({
      url: "http://localhost:3001/action",
      // processData: false,
      type: 'post',
      cache: false,
      // dataType: 'json',
      // contentType: 'application/json; charset=utf-8',
      data: { activity: JSON.stringify(this.getActionActivity(this.action)) },
    })
    .done(function(data) {
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      console.log("error:" + textStatus);
    });
  };

  // http://www.html5rocks.com/en/tutorials/cors/
  // response['Access-Control-Allow-Origin'] = '*'
  // response['Access-Control-Allow-Methods'] = 'POST, GET, OPTIONS'
  // response['Access-Control-Max-Age'] = 1000
  // # note that '*' is not valid for Access-Control-Allow-Headers
  // response['Access-Control-Allow-Headers'] = 'origin, x-csrftoken, content-type, accept'

  this.paintActivity = function(color) {
    console.log("activity.ux paintActivity");

    $('#debugMsg').text(JSON.stringify(this.getActionActivity('PAINT')));
    $.ajax({
      url: "http://localhost:3001/action",
      type: 'post',
      cache: false,
      data: { activity: JSON.stringify(this.getActionActivity('PAINT')) },
    })
    .done(function(data) {
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      console.log("error:" + textStatus);
    });
  }; //@ sourceURL=activity.ux
