<!-- Copyright 2014, SRI International -->
<html>
  <head>
    <title>Exercise UI</title>
    <script type="text/javascript" src="../eui.json.js"></script>
    <script type="text/javascript" src="../js/dat.gui.min.js"></script>
    <style type="text/css">
      #wrapper {
        position: absolute;
        left: 350px;
        top: 25px;
        color: black;
      }

      #assessment {
        display: none;
      }

      // dat.GUI style inspired by ...
      // http://brm.io/dat-gui-light-theme/
      // https://github.com/liabru/dat-gui-light-theme

      .dg.main.taller-than-window .close-button {
        border-top: 1px solid #ddd;
      }

      .dg.main .close-button {
        background-color: #ccc;
      }
       
      .dg.main .close-button:hover {
        background-color: #ddd;
      }

      .dg {
        color: #555;
        text-shadow: none !important;
      }

      .dg.main::-webkit-scrollbar {
        background: #fafafa;
      }

      .dg.main::-webkit-scrollbar-thumb {
        background: #bbb;
      }
       
      .dg li:not(.folder) {
        background: #fafafa;
        border-bottom: 1px solid #ddd;
      }
       
      .dg li.save-row .button {
        text-shadow: none !important;
      }

      .dg li.title {
        background: #e8e8e8 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
      }

      .dg .cr.function .property-name {
        width: inherit;
      }

      .dg .cr.function:hover,.dg .cr.boolean:hover {
        background: #fff;
      }
       
      .dg .c input[type=text] {
        background: #e9e9e9;
      }
       
      .dg .c input[type=text]:hover {
        background: #eee;
      }
       
      .dg .c input[type=text]:focus {
        background: #eee;
        color: #555;
      }
       
      .dg .c .slider {
        background: #e9e9e9;
      }

      .dg .c .slider:hover {
        background: #eee;
      }
    </style>
    <script type="text/javascript">
      var __EUI; // resist doing "= undefined, or = null" we just need it named and an async event will bind it!

      (function() {
      var cssIFrame = {
        'border': '1px outset #999999',
        'width': '450px',
        'height': '600px',
        'background-color': 'rgba(228, 228, 228, 0.8)'
      };
      var vwfapp = {
        appId: vwf_view.kernel.application(),
        tooltray: undefined,
        M4_Carbine_daeId: undefined,
        idToName: undefined,
        assessmentServerAddress: undefined
      };
      var M4 = {
        toolTrayGUI: undefined,
        toolTrayMenu: undefined,
        cameraMenu: undefined,
        cameraGUI: undefined,
        contextMenu: undefined,
        contextGUI: undefined,
        contextActive: false,
        guiref: { ctx: [ ] },
        assessmentActive: false,
        PointWeaponInSafeDirection: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'PointWeaponInSafeDirection');
          handleContextMenu();
        },
        addSelectorLeverActionGroup: function() {
          var selectorLeverFolder = M4.toolTrayGUI.addFolder("Selector Lever");

          selectorLeverFolder.add(M4.toolTrayMenu, 'semi').name('SEMI');
          selectorLeverFolder.add(M4.toolTrayMenu, 'safe').name('SAFE');
          selectorLeverFolder.add(M4.toolTrayMenu, 'burst').name('BURST');
          $('div.dg ul li.title').click();
        },
        semi: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'SelectModeSemi');
          handleContextMenu();
        },
        safe: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'SelectModeSafe');
          handleContextMenu();
        },
        burst: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'SelectModeBurst');
          handleContextMenu();
        },
        PushMagazineReleaseButton: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'PushMagazineReleaseButton');
          handleContextMenu();
        },
        PullAndHoldChargingHandle: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'PullAndHoldChargingHandle');
          handleContextMenu();
        },
        PushAndHoldBoltCatchBottom: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'PushAndHoldBoltCatchBottom');
          handleContextMenu();
        },
        ReleaseChargingHandle: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'ReleaseChargingHandle');
          handleContextMenu();
        },
        LetGoOfBoltCatchBottom: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'LetGoOfBoltCatchBottom');
          handleContextMenu();
        },
        PushChargingHandleForward: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'PushChargingHandleForward');
          handleContextMenu();
        },
        CheckChamberAndReceiverForAmmo: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'CheckChamberAndReceiverForAmmo');
          handleContextMenu();
        },
        PushBoltCatchTop: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'PushBoltCatchTop');
          handleContextMenu();
        },
        PullTrigger: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'PullTrigger');
          handleContextMenu();
        },
        init: function() {
          $('#backendtxrxMsg').hide();
          this.toolTrayMenu = new ToolTrayMenu();
          this.toolTrayGUI = new dat.GUI();
          this.toolTrayGUI.name = 'Tool Tray';
          M4.guiref.m4c = this.toolTrayGUI.add(this.toolTrayMenu, 'm4Carbine').name(vwfapp.tooltray[0].name);

          this.cameraMenu = new CameraMenu();
          this.cameraGUI = new dat.GUI();
          this.cameraGUI.name = 'Camera Menu';
          this.cameraGUI.add(this.cameraMenu, 'reset').name('Reset');
          this.cameraGUI.add(this.cameraMenu, 'backendtxrxMsg').name('Messages').onFinishChange(function(value) {
            if (value) $('#backendtxrxMsg').show();
            else $('#backendtxrxMsg').hide();
          });
          this.cameraGUI.add(this.cameraMenu, 'cameraOrbit', -180, 180).name('Orbit').onChange(function(value) {
            vwf_view.kernel.callMethod(vwfapp.appId, "orbit", [ -value - 90 ]); // really we start at -90 behind the target, so we multiply by -1
          });
          this.cameraGUI.add(this.cameraMenu, 'cameraZoom', 0, 90).step(1).name('Zoom').onChange(function(value) {
            vwf_view.kernel.callMethod(vwfapp.appId, 'zoom', [ value ]);
          }).onFinishChange(function(value) {
            vwf_view.kernel.callMethod(vwfapp.appId, 'lookAt', [ null ]);
          });
          this.cameraGUI.add(this.cameraMenu, 'assessment').name('Assessment');
          this.cameraGUI.autoPlace = false;
          this.cameraGUI.domElement.style.position = 'fixed';
          this.cameraGUI.domElement.style.float = 'left';
          this.cameraGUI.domElement.style.left = '15px';
          this.cameraGUI.domElement.style.overflowX = 'visible';
          this.cameraGUI.domElement.style.visibility = 'hidden';
          $('body').append(this.cameraGUI.domElement);

          this.contextMenu = new ContextMenu();
          this.contextGUI = new dat.GUI();
          this.contextGUI.name = 'Context Menu';
          this.contextGUI.autoPlace = false;
          this.contextGUI.domElement.style.position = 'absolute';
          $('body').append(this.contextGUI.domElement);
          $('div.close-button:last').css('display', 'none');
        }
      };
      var CameraMenu = function() {
        this.backendtxrxMsg = false;
        this.cameraOrbit = 0;
        this.cameraZoom = 0;
        this.reset = function() {
          vwf_view.kernel.callMethod(vwfapp.appId, 'resetBackend');
        };
        this.assessment = function() {
          if (!M4.assessmentActive) {
            // vwf_view.kernel.callMethod(vwfapp.M4_Carbine_daeId, 'assessment');
            $('<iframe/>', {
              name: 'assessment',
              id:   'assessmentIFrame',
              src:  vwfapp.assessmentServerAddress
            }).appendTo('#assessment').css(cssIFrame);
            $('#assessment').fadeIn();
            M4.assessmentActive = true;
            $('.dg.ac').toggle();
          }
        };
      };
      var ToolTrayMenu = function() {
        this.PointWeaponInSafeDirection = M4.PointWeaponInSafeDirection;
        this.semi = M4.semi;
        this.safe = M4.safe;
        this.burst = M4.burst;
        this.PushMagazineReleaseButton = M4.PushMagazineReleaseButton;
        this.PullAndHoldChargingHandle = M4.PullAndHoldChargingHandle;
        this.PushAndHoldBoltCatchBottom = M4.PushAndHoldBoltCatchBottom;
        this.ReleaseChargingHandle = M4.ReleaseChargingHandle;
        this.LetGoOfBoltCatchBottom = M4.LetGoOfBoltCatchBottom;
        this.PushChargingHandleForward = M4.PushChargingHandleForward;
        this.CheckChamberAndReceiverForAmmo = M4.CheckChamberAndReceiverForAmmo;
        this.PushBoltCatchTop = M4.PushBoltCatchTop;
        this.PullTrigger = M4.PullTrigger;

        this.m4Carbine = function() {
          Pace.restart(); // Loading the asset takes a long time, show the busy status, look for Pace.stop() after initInstance is called in the model
          M4.toolTrayGUI.remove(M4.guiref.m4c);
          vwf_view.kernel.callMethod(vwfapp.appId, 'instance', [ vwfapp.tooltray[0].name, vwfapp.tooltray[0].ID ]);
          M4.toolTrayGUI.add(M4.toolTrayMenu, 'PointWeaponInSafeDirection').name('Position Weapon');
          M4.addSelectorLeverActionGroup();
          M4.toolTrayGUI.add(M4.toolTrayMenu, 'PushMagazineReleaseButton').name('Push Magazine Release Button');
          M4.toolTrayGUI.add(M4.toolTrayMenu, 'PullAndHoldChargingHandle').name('Pull And Hold Charging Handle');
          M4.toolTrayGUI.add(M4.toolTrayMenu, 'PushAndHoldBoltCatchBottom').name('Push And Hold Bolt Catch Bottom');
          M4.toolTrayGUI.add(M4.toolTrayMenu, 'ReleaseChargingHandle').name('Release Charging Handle');
          M4.toolTrayGUI.add(M4.toolTrayMenu, 'LetGoOfBoltCatchBottom').name('Let Go Of Bolt Catch Bottom');
          M4.toolTrayGUI.add(M4.toolTrayMenu, 'PushChargingHandleForward').name('Push Charging Handle Forward');
          M4.toolTrayGUI.add(M4.toolTrayMenu, 'CheckChamberAndReceiverForAmmo').name('Check Chamber and Receiver For Ammo');
          M4.toolTrayGUI.add(M4.toolTrayMenu, 'PushBoltCatchTop').name('Push Bolt Catch Top');
          M4.toolTrayGUI.add(M4.toolTrayMenu, 'PullTrigger').name('Pull Trigger');
        };
      };
      var ContextMenu = function() {
        this.close = function() {
          handleContextMenu();
        };
        this.PointWeaponInSafeDirection = M4.PointWeaponInSafeDirection;
        this.semi = M4.semi;
        this.safe = M4.safe;
        this.burst = M4.burst;
        this.PushMagazineReleaseButton = M4.PushMagazineReleaseButton;
        this.PullAndHoldChargingHandle = M4.PullAndHoldChargingHandle;
        this.PushAndHoldBoltCatchBottom = M4.PushAndHoldBoltCatchBottom;
        this.ReleaseChargingHandle = M4.ReleaseChargingHandle;
        this.LetGoOfBoltCatchBottom = M4.LetGoOfBoltCatchBottom;
        this.PushChargingHandleForward = M4.PushChargingHandleForward;
        this.CheckChamberAndReceiverForAmmo = M4.CheckChamberAndReceiverForAmmo;
        this.PushBoltCatchTop = M4.PushBoltCatchTop;
        this.PullTrigger = M4.PullTrigger;
      };

      function handleContextMenu() {
        if (M4.contextActive) {
          var l = M4.guiref.ctx.length;

          for (var i = 0; i < l; i++) {
            M4.contextGUI.remove(M4.guiref.ctx[ i ]);
          }

          M4.guiref.ctx = [ ];
          M4.contextActive = false;
        }
      }

      function sceneInitialize() {
        // Property observers...
        vwf_view.satProperty = function(nodeId, propertyName, propertyValue) {
          if (nodeId == vwfapp.appId) {
            if (propertyName == 'backendResetSent') {
              if (propertyValue) window.location.reload(true); // window.location.href = window.location.href;
            }
          }
        };

        // notice the methodValue for the function return value as needed...
        vwf_view.calledMethod = function(nodeId, methodName, methodParameters, methodValue) {
          if (methodName == 'processEuiDotJson') {
            var callback = function(data) {
              console.info('the view tooltray data is ' + JSON.stringify(data));
              vwfapp.tooltray = data.tooltray;
              M4.init();
              Pace.stop(); // We should not need to do this, but sometimes the Pace progress just hangs around too long...
            };
            var url = vwf.getProperty(vwfapp.appId, 'inventoryServerAddress');

            if (!url)  {
              console.warn('using __EUI to get inventory server address');
              url = __EUI.baseServerAddress + '/inventory';
            }

            $.ajax({
              url: url,
              type: 'get',
              cache: false
            })
            .done(callback)
            .fail(function(jqXHR, textStatus, errorThrown) {
              console.info('using inventoryServerAddress:' + url);
              console.warn("error:" + textStatus);
            });
          } else if (methodName == 'initInstance') {
            Pace.stop(); // Loading the asset takes a long time, we are done manually remove busy status and adjust the menu width
            M4.cameraGUI.domElement.style.visibility = 'visible';
            vwfapp.M4_Carbine_daeId = vwf_view.kernel.find(vwfapp.appId, "//M4_Carbine_dae")[ 0 ];
            vwfapp.idToName = vwf.getProperty(vwfapp.M4_Carbine_daeId, "__idToName");
            vwfapp.assessmentServerAddress = vwf.getProperty(vwfapp.M4_Carbine_daeId, 'assessmentServerAddress');
          }
        };

        // Event observers...
        vwf_view.firedEvent = function(nodeId, eventName, eventArgs) {
          if (eventName != 'pointerDown') return;

          // console.log(nodeId); /* Example: */
          //   index-vwf:6-98-M4_Carbine_dae:10-80-Selector_Lever
          //   index-vwf:6-98-M4_Carbine_dae
          //   index-vwf 

          if (M4.contextActive) return; // parents and children fire the event so we only want to handle this once and return for all others

          console.info('firedEvent pointerDown in the html view for ' + eventArgs[ 1 ].pickID);

          if (nodeId == vwfapp.M4_Carbine_daeId) {
            M4.contextActive = true; // we will see fired events for the parent and the child, so I only need to handle it once...
            M4.contextGUI.domElement.style.left = eventArgs[ 0 ].screenPosition[ 0 ] + 'px';
            M4.contextGUI.domElement.style.top = eventArgs[ 0 ].screenPosition[ 1 ] + 'px';

            switch (vwfapp.idToName[ eventArgs[ 1 ].pickID ]) {
            case 'Magazine_Catch':
            case 'Magazine_Catch_Button':
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'close').name('(X) Close'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'PushMagazineReleaseButton').name('Push Magazine Release Button'));
              break;
            case 'Selector_Lever':
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'close').name('(X) Close'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'semi').name('SEMI'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'safe').name('SAFE'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'burst').name('BURST'));
              break;
            case 'Charging_Handle':
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'close').name('(X) Close'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'PullAndHoldChargingHandle').name('Pull And Hold Charging Handle'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'ReleaseChargingHandle').name('Release Charging Handle'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'PushChargingHandleForward').name('Push Charging Handle Forward'));
              break;
            case 'Bolt_Catch':
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'close').name('(X) Close'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'PushAndHoldBoltCatchBottom').name('Push And Hold Bolt Catch Bottom'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'LetGoOfBoltCatchBottom').name('Let Go Of Bolt Catch Bottom'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'PushBoltCatchTop').name('Push Bolt Catch Top'));
              break;
            case 'Ejection_Port_Cover':
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'close').name('(X) Close'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'CheckChamberAndReceiverForAmmo').name('Check Chamber And Receiver For Ammo'));
              break;
            case 'Trigger':
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'close').name('(X) Close'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'PullTrigger').name('Pull Trigger'));
              break;
            default: // Everything else, barrel, stock, etc, is position the weapon...
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'close').name('(X) Close'));
              M4.guiref.ctx.push(M4.contextGUI.add(M4.contextMenu, 'PointWeaponInSafeDirection').name('Position Weapon'));
              break;
            }
          }
        };

        $(window).unload(function() { sceneDestroy(); });
      }

      function sceneDestroy() {
      }


// http://jsfiddle.net/AddictArts/e81vmmgo/8/
//
// CoffeeScript
// scene = null
// outScene = null
// light = null
// renderer = null
// camera = null
// mesh1 = null
// mesh2 = null

// screenWidth  = window.innerWidth
// screenHeight = window.innerHeight
// clock = new THREE.Clock
// elapsedTime = 0
// frameCount  = 0

// shader =
//     'outline' :
//         vertex_shader: [
//             "uniform float offset;",
//             "void main() {",
//                 "vec4 pos = modelViewMatrix * vec4( position + normal * offset, 1.0 );",
//                 "gl_Position = projectionMatrix * pos;",
//             "}"
//         ].join("\n"),
//         fragment_shader: [
//             "void main(){",
//                 "gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );",
//             "}"
//         ].join("\n")

// init = () ->
//     # SCENE
//     scene = new THREE.Scene
//     outScene = new THREE.Scene
//     setModel()

//     # CAMERA
//     camera = new THREE.PerspectiveCamera 40, screenWidth/screenHeight, 50, 10000
//     camera.position.set 0, 0, 400

//     # LIGHTS
//     light = new THREE.DirectionalLight 0xffffff
//     light.position.set 1, 1, 1
//     scene.add light

//     # RENDERER
//     renderer = new THREE.WebGLRenderer
//         width: screenWidth
//         height: screenHeight
//         antialias: true

//     renderer.setSize screenWidth, screenHeight
//     renderer.setClearColor 0x666666
//     renderer.autoClear = false
//     renderer.gammaInput = true
//     renderer.gammaOutput = true
//     document.body.appendChild renderer.domElement
//     # EVENTS
//     window.addEventListener 'resize', onWindowResize, false

// setModel = ->
//     geometry = new THREE.TorusKnotGeometry 50, 10, 128, 16
//     # SHADED MODEL
//     matColor = new THREE.MeshPhongMaterial 0xffffff
//     mesh1 = new THREE.Mesh geometry, matColor
//     scene.add mesh1

//     # SHADER
//     uniforms = offset:
//         type: "f"
//         value: 1

//     outShader = shader['outline']
//     matShader = new THREE.ShaderMaterial
//         uniforms: uniforms,
//         vertexShader: outShader.vertex_shader,
//         fragmentShader: outShader.fragment_shader,

//     mesh2 = new THREE.Mesh geometry, matShader
//     mesh2.material.depthWrite = false; # <==============
//     mesh2.quaternion = mesh1.quaternion;
//     outScene.add mesh2

// onWindowResize = ->
//     screenWidth  = window.innerWidth
//     screenHeight = window.innerHeight
//     camera.aspect = screenWidth / screenHeight
//     camera.updateProjectionMatrix()
//     renderer.setSize screenWidth, screenHeight

// animate = ->
//     updateFps()
//     requestAnimationFrame animate
//     render()

// render = ->
//     now = Date.now()
//     delta = clock.getDelta()
//     mesh1.rotation.y += 0.01
//     renderer.render(outScene, camera) # <==============
//     renderer.render(scene, camera) # <==============

// updateFps = ->
//     elapsedTime += clock.getDelta()
//     frameCount++

//     if elapsedTime >= 1
//         $('#fps').html frameCount
//         frameCount  = 0
//         elapsedTime = 0

// init()
// # hide gl.getProgramInfoLog() WARNING: Could not find vertex shader attribute 'position' ...
// renderer.context.getProgramInfoLog = () ->
//     return ''
// animate()


// From vwf/support/client/lib/vwf/view/threejs.js
// var scene = sceneNode.threeScene;
// window._dScene = scene;
// _dRenderer
//   THREE.WebGLRenderer {domElement: canvas#index-vwf.vwf-scene, context: WebGLRenderingContext, devicePixelRatio: 1, autoClear: true, autoClearColor: true…}
// _dScene.getObjectByName('sky', true)
// THREE.Mesh {id: 34, uuid: "7B8740A6-DCDC-48AF-8009-A22DF0EECB46", name: "sky", parent: THREE.Object3D, children: Array[0]…}
// _dScene.getObjectByName('targets', true)
// THREE.Mesh {id: 35, uuid: "FA5A35F8-B909-47AD-8FDC-DE374D8FAE60", name: "targets", parent: THREE.Object3D, children: Array[0]…}

      // vwf html view initialization event, you don't have window.onload and document.ready is not good enough...
      // initialization, yes it can be done this way... from tile-puzzle-2D example
      vwf_view.initializedNode = function(nodeID, childID, childExtendsID, childImplementsIDs, childSource, childType, childIndex, childName) {
        if (childID == vwfapp.appId) {
          sceneInitialize();
          vwf_view.kernel.callMethod(vwfapp.appId, 'processEuiDotJson', [ __EUI ]);

          var scene = null,
              light = null,
              renderer = null,
              camera = null,
              mesh = null;
          var container = document.getElementById('ctx2');
          var containerWidth  = 320; //window.innerWidth;
          var containerHeight = 180; //window.innerHeight;

          var init = function() {
              // THREE.Scene
              scene = new THREE.Scene();
              setModel();
              // THREE.Camera
              camera = new THREE.PerspectiveCamera(40, containerWidth / containerHeight, 50, 10000);
              camera.position.set(0, 0, 400);
              // THREE.Lights
              light = new THREE.DirectionalLight(0xffffff);
              light.position.set(1, 1, 1);
              scene.add(light);
              // THREE.WebGLRenderer
              renderer = new THREE.WebGLRenderer({
                  width: containerWidth,
                  height: containerHeight,
                  antialias: true
              });
              renderer.setSize(containerWidth, containerHeight);
              renderer.setClearColor(0x666666);
              renderer.autoClear = false;
              renderer.gammaInput = true;
              renderer.gammaOutput = true;
              container.appendChild(renderer.domElement);
          };
          var setModel = function() {
              var geometry = new THREE.TorusKnotGeometry(50, 10, 128, 16);
              var matColor = new THREE.MeshPhongMaterial(0xffffff);
              mesh = new THREE.Mesh(geometry, matColor);
              scene.add(mesh);
          };
          var animate = function() {
              requestAnimationFrame(animate);
              render();
          };
          var render = function() {
              mesh.rotation.y += 0.01;
              renderer.render(scene, camera);
          };

          init();
          // hide gl.getProgramInfoLog() WARNING: Could not find vertex shader attribute 'position' ...
          renderer.context.getProgramInfoLog = function() { return ''; };
          // render();
          animate();


        }
      }
      })(); //# sourceURL=index.vwf.html
    </script>
  </head>
<body>
  <div id="wrapper" class="wrapper">
    <div id="backendtxrxMsg"></div>
    <div id="assessment"></div>
  </div>
  <script type="text/javascript">
    $('#wrapper').appendTo('#vwf-root');
  </script>
  <!-- div id="ctx2" style="border: 1px solid red; float: left; width: 320px; height: 180px"></div -->
</body>
</html>
