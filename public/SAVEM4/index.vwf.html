<html>
  <head>
    <title>Exercise UI</title>
    <script type="text/javascript" src="../js/dat.gui.min.js"></script>
    <script type="text/javascript">
      (function() {
      var vwf = {
        m4_CarbineID: undefined,
        cameraID: undefined,
        appID: vwf_view.kernel.application()
      };

      var M4 = {
        gui: undefined,
        tray: undefined,
        guiref: { },
        Tooltray: function() {
          this.activityMsg = true;
          this.cameraOrbit = 90.0;
          this.cameraYaw = 90.0;
          this.cameraZoom = 0.0;
          this.m4Carbine = function() {
            M4.gui.remove(M4.guiref.m4c);
            vwf_view.kernel.callMethod(vwf.appID, 'instance', ['M4_Carbine_dae', 'models/M4_lowPoly_06.dae']);
            M4.tray.positionWeapon = M4.positionWeapon;
            M4.gui.add(M4.tray, 'positionWeapon').name('Position Weapon');
            M4.tray.selectorLever = M4.selectorLever;
            M4.guiref.sl = M4.gui.add(M4.tray, 'selectorLever').name('Selector Lever').onFinishChange(M4.addSelectorLeverActionGroup);

            M4.tray.magazineCatch = M4.magazineCatch;
            M4.gui.add(M4.tray, 'magazineCatch').name('Magazine Catch');
            M4.tray.magazine = M4.magazine;
            M4.gui.add(M4.tray, 'magazine').name('Magazine');
          };
        },
        positionWeapon: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'positionWeapon');
        },
        selectorLever: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'selectorLever');
        },
        addSelectorLeverActionGroup: function() {
          var selectorLeverFolder = M4.gui.addFolder("Selecctor Lever");

          M4.gui.remove(M4.guiref.sl);
          M4.tray.semi = M4.semi;
          selectorLeverFolder.add(M4.tray, 'semi').name('SEMI');
          M4.tray.safe = M4.safe;
          selectorLeverFolder.add(M4.tray, 'safe').name('SAFE');
          M4.tray.burst = M4.burst;
          selectorLeverFolder.add(M4.tray, 'burst').name('BURST');
        },
        semi: function() {
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'selectorLeverSemi');
        },
        safe: function() {
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'selectorLeverSafe');
        },
        burst: function() {
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'selectorLeverBurst');
        },
        magazineCatch: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'magazineCatch');
        },
        magazine: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'magazine');
        },

        init: function() {
          this.tray = new this.Tooltray();
          this.gui = new dat.GUI();
          this.gui.add(this.tray, 'activityMsg').name('Messages');
          this.gui.add(this.tray, 'cameraOrbit', 0.0, 180.0).name('Cam Orbit').onChange(function(value) {
            vwf_view.kernel.callMethod(vwf.appID, "orbit", [ -value ]); // really we start at -90 behind the target, so we multiply by -1.0
          });
          // this.gui.add(this.tray, 'cameraYaw', 0.0, 180.0).name('Cam Yaw').onChange(function(value) {
          //   vwf.cameraID = vwf.cameraID || vwf_view.kernel.find(vwf.appID, "//camera");
          //   vwf_view.kernel.setProperty(vwf.cameraID, "rotation", [ 0.0, 0.0, 1.0, -value ]);
          // }).onFinishChange(function() {
          //   M4.tray.cameraYaw = 90.0;

          //   for (var i in M4.gui.__controllers) {
          //     M4.gui.__controllers[i].updateDisplay();
          //   }

          //   vwf.cameraID = vwf.cameraID || vwf_view.kernel.find(vwf.appID, "//camera");
          //   vwf_view.kernel.setProperty(vwf.cameraID, "rotation", [ 0.0, 0.0, 1.0, -90.0 ]);
          // });
          this.gui.add(this.tray, 'cameraZoom', 0.0, 90.0).step(1.0).name('Cam Zoom').onFinishChange(function(value) {
            vwf_view.kernel.callMethod(vwf.appID, "zoom", [ value ]);
          });
          M4.guiref.m4c = this.gui.add(this.tray, 'm4Carbine').name('M4 Carbine');
        }
      };

      function SceneInitialize() {
        M4.init();
        $(window).unload(function() { SceneDestroy(); });
      }

      function SceneDestroy() {
      }

      $(document).ready(function() { SceneInitialize(); });
      })(); //@ sourceURL=index.vwf.html
    </script>
  </head>
<body>
  <div id="wrapper" class="wrapper" style="position:absolute;left:25px;top:25px;">
    <div id="actionMsg"></div>
  </div>
  <script type="text/javascript">
    $('#wrapper').appendTo('#vwf-root');
  </script>
</body>
</html>
