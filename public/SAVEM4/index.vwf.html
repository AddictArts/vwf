<html>
  <head>
    <title>Exercise UI</title>
    <script type="text/javascript" src="../js/dat.gui.min.js"></script>
    <script type="text/javascript">
      (function() {
      var vwf = {
        m4_CarbineID: undefined,
        cameraID: undefined,
        appID: vwf_view.kernel.application()
      };

      var M4 = {
        gui: undefined,
        tray: undefined,
        guiref: { },
        Tooltray: function() {
          this.backendtxrxMsg = false;
          this.cameraOrbit = 0;
          this.cameraZoom = 0;
          this.reset = M4.reset;

          this.m4Carbine = function() {
            M4.gui.remove(M4.guiref.m4c);
            vwf_view.kernel.callMethod(vwf.appID, 'instance', [ ]);
            M4.tray.PointWeaponInSafeDirection = M4.PointWeaponInSafeDirection;
            M4.gui.add(M4.tray, 'PointWeaponInSafeDirection').name('Position Weapon');
            M4.addSelectorLeverActionGroup();
            M4.tray.PushMagazineReleaseButton = M4.PushMagazineReleaseButton;
            M4.gui.add(M4.tray, 'PushMagazineReleaseButton').name('Magazine Catch');

            M4.tray.PullAndHoldChargingHandle = M4.PullAndHoldChargingHandle;
            M4.gui.add(M4.tray, 'PullAndHoldChargingHandle').name('Pull And Hold Charging Handle');
            M4.tray.PushAndHoldBoltCatchBottom = M4.PushAndHoldBoltCatchBottom;
            M4.gui.add(M4.tray, 'PushAndHoldBoltCatchBottom').name('Push And Hold Bolt Catch Bottom');
            M4.tray.ReleaseChargingHandle = M4.ReleaseChargingHandle;
            M4.gui.add(M4.tray, 'ReleaseChargingHandle').name('Release Charging Handle');
            M4.tray.LetGoOfBoltCatchBottom = M4.LetGoOfBoltCatchBottom;
            M4.gui.add(M4.tray, 'LetGoOfBoltCatchBottom').name('Let Go Of Bolt Catch Bottom');

            M4.tray.assessment = M4.assessment;
            M4.gui.add(M4.tray, 'assessment').name('Assessment');
          };
        },
        reset: function() {
          //vwf_view.kernel.callMethod(vwf.appID, 'removeInstance');
          //window.location.reload();
          window.location.reload(true);
          //window.location.href=window.location.href;
        },
        PointWeaponInSafeDirection: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'PointWeaponInSafeDirection');
        },
        addSelectorLeverActionGroup: function() {
          var selectorLeverFolder = M4.gui.addFolder("Selecctor Lever");

          M4.tray.semi = M4.semi;
          selectorLeverFolder.add(M4.tray, 'semi').name('SEMI');
          M4.tray.safe = M4.safe;
          selectorLeverFolder.add(M4.tray, 'safe').name('SAFE');
          M4.tray.burst = M4.burst;
          selectorLeverFolder.add(M4.tray, 'burst').name('BURST');
        },
        semi: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'SelectModeSemi');
        },
        safe: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'SelectModeSafe');
        },
        burst: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'SelectModeBurst');
        },
        PushMagazineReleaseButton: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'PushMagazineReleaseButton');
        },
        PullAndHoldChargingHandle: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'PullAndHoldChargingHandle');
        },
        PushAndHoldBoltCatchBottom: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'PushAndHoldBoltCatchBottom');
        },
        ReleaseChargingHandle: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'ReleaseChargingHandle');
        },
        LetGoOfBoltCatchBottom: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'LetGoOfBoltCatchBottom');
        },
        assessment: function() {
          vwf.m4_CarbineID = vwf.m4_CarbineID || vwf_view.kernel.find(vwf.appID, "//M4_Carbine_dae");
          vwf_view.kernel.callMethod(vwf.m4_CarbineID, 'assessment');
        },
        init: function() {
          $('#backendtxrxMsg').hide();
          this.tray = new this.Tooltray();
          this.gui = new dat.GUI();
          this.gui.add(this.tray, 'reset').name('Reset');
          this.gui.add(this.tray, 'backendtxrxMsg').name('Messages').onFinishChange(function(value) {
            if (value) $('#backendtxrxMsg').show('easing');
            else $('#backendtxrxMsg').hide('easing');
          });
          this.gui.add(this.tray, 'cameraOrbit', -180, 180).name('Orbit').onChange(function(value) {
            vwf_view.kernel.callMethod(vwf.appID, "orbit", [ -value - 90 ]); // really we start at -90 behind the target, so we multiply by -1
          });
          this.gui.add(this.tray, 'cameraZoom', 0, 90).step(1).name('Zoom').onChange(function(value) {
            vwf_view.kernel.callMethod(vwf.appID, "zoom", [ value ]);
          });
          M4.guiref.m4c = this.gui.add(this.tray, 'm4Carbine').name('M4 Carbine');
        }
      };

      function SceneInitialize() {
        M4.init();

        vwf_view.satProperty = function(nodeId, propertyName, propertyValue) {
          if (nodeId == vwf_view.kernel.application()) {
            switch (propertyName) {
            case "zoomedValue":
              console.log('Observing zoomedValue ' + propertyValue + ' in the html');
              break;
            }
          }
        }

        vwf_view.firedEvent = function(nodeId, eventName, eventArgs) {
          //console.log('firedEvent arg len:' + arguments.length + ' arg0:' + arguments[ 0 ] + ' arg1:' + arguments[ 1 ] + ' arg2:' + arguments[ 2 ]);

          if (nodeId == vwf_view.kernel.application()) {
            switch (eventName) {
            case "pointerDown":
              console.log('Observing pointerDown in the html');
              break;
            }
          }
        }

        $(window).unload(function() { SceneDestroy(); });
      }

      function SceneDestroy() {
      }

      $(document).ready(function() { SceneInitialize(); });
      })(); //@ sourceURL=index.vwf.html
    </script>
  </head>
<body>
  <div id="wrapper" class="wrapper" style="position:absolute;left:25px;top:25px;color:white;">
    <div id="backendtxrxMsg"></div>
    <div id="assessment"></div>
  </div>
  <script type="text/javascript">
    $('#wrapper').appendTo('#vwf-root');
  </script>
</body>
</html>
