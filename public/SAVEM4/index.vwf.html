<html>
  <head>
    <title>Exercise UI</title>
    <script type="text/javascript" src="../eui.json.js"></script>
    <script type="text/javascript" src="../js/dat.gui.min.js"></script>

<!--
vwf html view initialization event, you don't have window.onload and document.ready is not good enough.

NOTE: The callMethod and other kernel or view methods are async, so we have to work with it that way

The hidden gotProperty, we had docs on satProperty, from events.js bzflag example
vwf_view.gotProperty = function (nodeId, propertyName, propertyValue) {
    if (nodeId == sceneNode) {
        switch (propertyName) {
            case "scoreBoard": 
                updateScoreboard(propertyValue);
                break;
        }
    }
    else if (nodeId == playerNode) {
        switch (propertyName) {
            case "score":
                $("#userScore").text(propertyValue); 
                break;
        }
    }
}
vwf_view.kernel.getProperty(vwf_view.kernel.find("","/")[0], 'scoreBoard');


Initialization, yes it can be done this way... from tile-puzzle-2D example

      vwf_view.initializedNode = function( nodeID, childID, childExtendsID, childImplementsIDs,
          childSource, childType, childIndex, childName ) {
        if ( childID == vwf_view.kernel.application() ) {
          gameID = vwf_view.kernel.find("", "/game")[0];
          initializeBoard();
        }
      }


-=-=-=-=-=-=-=-=-=-=-=-

http://brm.io/dat-gui-light-theme/
https://github.com/liabru/dat-gui-light-theme

.dg.main.taller-than-window .close-button {
    border-top: 1px solid #ddd;
}

.dg.main .close-button {
    background-color: #ccc;
}
 
.dg.main .close-button:hover {
    background-color: #ddd;
}

.dg {
    color: #555;
    text-shadow: none !important;
}

.dg.main::-webkit-scrollbar {
    background: #fafafa;
}

.dg.main::-webkit-scrollbar-thumb {
    background: #bbb;
}
 
.dg li:not(.folder) {
    background: #fafafa;
    border-bottom: 1px solid #ddd;
}
 
.dg li.save-row .button {
    text-shadow: none !important;
}

.dg li.title {
    background: #e8e8e8 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
}

.dg .cr.function:hover,.dg .cr.boolean:hover {
    background: #fff;
}
 
.dg .c input[type=text] {
    background: #e9e9e9;
}
 
.dg .c input[type=text]:hover {
    background: #eee;
}
 
.dg .c input[type=text]:focus {
    background: #eee;
    color: #555;
}
 
.dg .c .slider {
    background: #e9e9e9;
}

.dg .c .slider:hover {
    background: #eee;
}


-->

    <script type="text/javascript">
      var __EUI;

      (function() {
      var vwfapp = {
        M4_CarbineID: undefined,
        cameraID: undefined,
        appID: vwf_view.kernel.application(),
        idToName: undefined
      };

      var M4 = {
        gui: undefined,
        tray: undefined,
        guiref: { },
        contextMenu: undefined,
        contextGUI: undefined,
        Tooltray: function() {
          this.backendtxrxMsg = false;
          this.cameraOrbit = 0;
          this.cameraZoom = 0;
          this.reset = M4.reset;
          // this.PointWeaponInSafeDirection = M4.PointWeaponInSafeDirection;
          // this.PushMagazineReleaseButton = M4.PushMagazineReleaseButton;

          this.m4Carbine = function() {
            Pace.restart(); // Loading the asset takes a long time, show the busy status, look for Pace.stop() after initInstance is called in the model
            M4.gui.remove(M4.guiref.m4c);

            vwf_view.kernel.callMethod(vwfapp.appID, 'instance', [ ]);

            M4.gui.add(M4.tray, 'backendtxrxMsg').name('Messages').onFinishChange(function(value) {
              if (value) $('#backendtxrxMsg').show('easing');
              else $('#backendtxrxMsg').hide('easing');
            });
            M4.gui.add(M4.tray, 'cameraOrbit', -180, 180).name('Orbit').onChange(function(value) {
              vwf_view.kernel.callMethod(vwfapp.appID, "orbit", [ -value - 90 ]); // really we start at -90 behind the target, so we multiply by -1
            });
            M4.gui.add(M4.tray, 'cameraZoom', 0, 90).step(1).name('Zoom').onChange(function(value) {
              vwf_view.kernel.callMethod(vwfapp.appID, 'zoom', [ value ]);
            }).onFinishChange(function(value) {
              vwf_view.kernel.callMethod(vwfapp.appID, 'lookAt', [ null ]);
            });

            M4.tray.PointWeaponInSafeDirection = M4.PointWeaponInSafeDirection;
            M4.gui.add(M4.tray, 'PointWeaponInSafeDirection').name('Position Weapon');
            M4.addSelectorLeverActionGroup();
            M4.tray.PushMagazineReleaseButton = M4.PushMagazineReleaseButton;
            M4.gui.add(M4.tray, 'PushMagazineReleaseButton').name('Magazine Catch');
            M4.tray.PullAndHoldChargingHandle = M4.PullAndHoldChargingHandle;
            M4.gui.add(M4.tray, 'PullAndHoldChargingHandle').name('Pull And Hold Charging Handle');
            M4.tray.PushAndHoldBoltCatchBottom = M4.PushAndHoldBoltCatchBottom;
            M4.gui.add(M4.tray, 'PushAndHoldBoltCatchBottom').name('Push And Hold Bolt Catch Bottom');
            M4.tray.ReleaseChargingHandle = M4.ReleaseChargingHandle;
            M4.gui.add(M4.tray, 'ReleaseChargingHandle').name('Release Charging Handle');
            M4.tray.LetGoOfBoltCatchBottom = M4.LetGoOfBoltCatchBottom;
            M4.gui.add(M4.tray, 'LetGoOfBoltCatchBottom').name('Let Go Of Bolt Catch Bottom');
            M4.tray.PushChargingHandleForward = M4.PushChargingHandleForward;
            M4.gui.add(M4.tray, 'PushChargingHandleForward').name('Push Charging Handle Forward');
            M4.tray.CheckChamberAndReceiverForAmmo = M4.CheckChamberAndReceiverForAmmo;
            M4.gui.add(M4.tray, 'CheckChamberAndReceiverForAmmo').name('Check Chamber and Receiver For Ammo');
            M4.tray.PushBoltCatchTop = M4.PushBoltCatchTop;
            M4.gui.add(M4.tray, 'PushBoltCatchTop').name('Push Bolt Catch Top');
            M4.tray.PullTrigger = M4.PullTrigger;
            M4.gui.add(M4.tray, 'PullTrigger').name('Pull Trigger');

            M4.tray.assessment = M4.assessment;
            M4.gui.add(M4.tray, 'assessment').name('Assessment');
          };
        },
        ContextMenu: function() {
          // this.picked = true;
        },
        reset: function() {
          //vwf_view.kernel.callMethod(vwfapp.appID, 'removeInstance');
          //window.location.href = window.location.href;
          //window.location.reload();
          vwf_view.kernel.callMethod(vwfapp.appID, 'resetBackend');
        },
        PointWeaponInSafeDirection: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'PointWeaponInSafeDirection');
        },
        addSelectorLeverActionGroup: function() {
          var selectorLeverFolder = M4.gui.addFolder("Selecctor Lever");

          M4.tray.semi = M4.semi;
          selectorLeverFolder.add(M4.tray, 'semi').name('SEMI');
          M4.tray.safe = M4.safe;
          selectorLeverFolder.add(M4.tray, 'safe').name('SAFE');
          M4.tray.burst = M4.burst;
          selectorLeverFolder.add(M4.tray, 'burst').name('BURST');
          $('div.dg ul li.title').click();
        },
        semi: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'SelectModeSemi');
        },
        safe: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'SelectModeSafe');
        },
        burst: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'SelectModeBurst');
        },
        PushMagazineReleaseButton: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'PushMagazineReleaseButton');
        },
        PullAndHoldChargingHandle: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'PullAndHoldChargingHandle');
        },
        PushAndHoldBoltCatchBottom: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'PushAndHoldBoltCatchBottom');
        },
        ReleaseChargingHandle: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'ReleaseChargingHandle');
        },
        LetGoOfBoltCatchBottom: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'LetGoOfBoltCatchBottom');
        },
        PushChargingHandleForward: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'PushChargingHandleForward');
        },
        CheckChamberAndReceiverForAmmo: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'CheckChamberAndReceiverForAmmo');
        },
        PushBoltCatchTop: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'PushBoltCatchTop');
        },
        PullTrigger: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'PullTrigger');
        },
        assessment: function() {
          vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'assessment');
        },
        init: function() {
          $('#backendtxrxMsg').hide();
          this.tray = new this.Tooltray();
          this.gui = new dat.GUI();
          this.gui.name = 'Tool Tray';
          this.gui.add(this.tray, 'reset').name('Reset');
          M4.guiref.m4c = this.gui.add(this.tray, 'm4Carbine').name('M4 Carbine');



          this.contextMenu = new this.ContextMenu();
          this.contextGUI = new dat.GUI();
          this.contextGUI.name = 'Context Menu';
          this.contextGUI.autoPlace = false;
          this.contextGUI.domElement.style.position = 'absolute';
          // this.contextGUI.domElement.style.position = 'fixed';
          // this.contextGUI.domElement.style.top = '20px';
          // this.contextGUI.domElement.style.float = 'right';
          // this.contextGUI.domElement.style.float = 'left';
          // this.contextGUI.domElement.style.left = '20px';
          // this.contextGUI.domElement.style.right = '20px';
          $('body').append(this.contextGUI.domElement);
        }
      };

      function SceneInitialize() {
        M4.init();
        vwf_view.kernel.callMethod(vwfapp.appID, "processEuiDotJson", [ __EUI ]);

        // Property observers...
        vwf_view.satProperty = function(nodeId, propertyName, propertyValue) {
          if (nodeId == vwfapp.appID) {
            if (propertyName == 'backendResetSent') {
              if (propertyValue) window.location.reload(true);
            }
          }
        };

        // notice the methodValue for the function return value as needed...
        vwf_view.calledMethod = function(nodeId, methodName, methodParameters, methodValue) {
          if (methodName == 'initInstance') {
            Pace.stop(); // Loading the asset takes a long time, we are done manually remove busy status and adjust the menu width
            $('div.dg div.main, div.close-button').css('width', '550px');
            vwfapp.M4_CarbineID = vwfapp.M4_CarbineID || vwf_view.kernel.find(vwfapp.appID, "//M4_Carbine_dae");
            vwfapp.idToName = vwf.getProperty(vwfapp.M4_CarbineID, "__idToName");
            // console.log(vwfapp.idToName);
          } else if (methodName == 'assessment') {
            $('#assessmentIFrame').css({
              'border': '1px outset #999999',
              'width': '450px',
              'height': '600px',
              'background-color': 'rgba(228, 228, 228, 0.8)'
            });
          }
        }

        // Event observers...
        vwf_view.firedEvent = function(nodeId, eventName, eventArgs) {
          //console.log('firedEvent arg len:' + arguments.length + ' arg0:' + arguments[ 0 ] + ' arg1:' + arguments[ 1 ] + ' arg2:' + arguments[ 2 ]);

          if (nodeId == vwfapp.appID) {
            switch (eventName) {
            case "pointerDown":
              console.log('Observing pointerDown in the html view');
              // console.log(eventArgs);
              // console.log(eventArgs[ 0 ].screenPosition[ 0 ] + 'px');
              // console.log(eventArgs[ 0 ].screenPosition[ 1 ] + 'px');
              M4.contextGUI.domElement.style.left = eventArgs[ 0 ].screenPosition[ 0 ] + 'px';
              M4.contextGUI.domElement.style.top = eventArgs[ 0 ].screenPosition[ 1 ] + 'px';

              // M4.contextGUI.add(M4.contextMenu, 'picked');

              M4.ContextMenu.PointWeaponInSafeDirection = M4.PointWeaponInSafeDirection;
              M4.contextGUI.add(M4.ContextMenu, 'PointWeaponInSafeDirection').name('Position Weapon');

              // vwf_view.kernel.callMethod(vwfapp.M4_CarbineID, 'vpick', [ eventArgs[ 1 ].pickID ]);

              break;
            }
          }
        };

        $(window).unload(function() { SceneDestroy(); });
      }

      function SceneDestroy() {
      }

      $(document).ready(function() { SceneInitialize(); });
      })(); //@ sourceURL=index.vwf.html
    </script>
  </head>
<body>
  <div id="wrapper" class="wrapper" style="position: absolute; left: 25px; top: 25px; color: white;">
    <div id="backendtxrxMsg"></div>
    <div id="assessment"></div>
  </div>
  <script type="text/javascript">
    $('#wrapper').appendTo('#vwf-root');
  </script>
</body>
</html>
