<!-- Copyright 2014, SRI International -->
<html>
  <script type="text/javascript" src="vwf/model/threejs/three.js"></script>
  <script type="text/javascript" src="vwf/model/threejs/js/loaders/ColladaLoader.js"></script>
  <script type="text/javascript" src="js/tow.js"></script>
  <script type="text/javascript" src="js/dat.gui.min.js"></script>
  <script>
TOW.Camera.position.set(-0.25, 0, 0.125); //XXX make dat gui able to set this vector maybe
// TOW.Camera.position.set(-10, 5, 5);
TOW.Camera.lookAt(new THREE.Vector3(0, 0, 0));
TOW.addLight().position.set(-1, 0.5, 0.5);
TOW.addLight({ type: 'Ambient' });
TOW.addGrid(14, 0.125, 0x303030);
TOW.loadCollada('models/xyzbar.dae', 'xyzbar_dae', true, function() {
  TOW.ColladaScenes.xyzbar_dae.scale.set(0.005, 0.005, 0.005);
  TOW.render();
});
// TOW.loadColladas([ 'models/M4_Environment_01.dae' ], false);
TOW.loadColladas([ 'models/M4_Environment_01.dae', 'models/M4_v09.dae' ], false, function() { onloadTowDatGui(); });
  </script>

  <script>
var TowDatMenu = function() {
  var self = this;
  var n;

  this.meshCache = { }; // mesh references by name
  this.targets = function() {
    n = 'targets';
    focusSelected(TOW.ColladaScenes.M4_Environment_01_dae);
  };
  this.ShootingRangeArea8 = function() {
    n = 'ShootingRangeArea8';
    focusSelected(TOW.ColladaScenes.M4_Environment_01_dae);
  };
  this.Trigger = function() {
    n = 'Trigger';
    focusSelected(TOW.ColladaScenes.M4_v09_dae, rotateZ);
  };
  this.Selector_Lever = function() {
    n = 'Selector_Lever';
    focusSelected(TOW.ColladaScenes.M4_v09_dae);
  };
  this.Gun_Carrying_Handle = function() {
    n = 'Gun_Carrying_Handle';
    focusSelected(TOW.ColladaScenes.M4_v09_dae);
  };

  function _onRender(t, pivot) {
    pivot.rotation.y += 0.005;
  }

  function rotateZ(t, pivot) {
    pivot.rotation.z += 0.005;
  }

  function focusSelected(dae, onRender) {
    onRender = onRender || _onRender;

    if (self.meshCache[ n ] === undefined) self.meshCache[ n ] = TOW.findMeshVisibleAndCenterRender(n, dae, onRender);
  }
};

// window.onload =
function onloadTowDatGui() {
  var towDatMenu = new TowDatMenu();
  var towDatGUI = new dat.GUI();

  towDatGUI.add(towDatMenu, 'targets');
  towDatGUI.add(towDatMenu, 'ShootingRangeArea8');
  towDatGUI.add(towDatMenu, 'Trigger');
  towDatGUI.add(towDatMenu, 'Selector_Lever');
  towDatGUI.add(towDatMenu, 'Gun_Carrying_Handle');
}
  </script>
<body>
</body>
</html>
